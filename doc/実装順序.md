# 段階的実装計画

## フェーズ 1: バックエンドの基本 API 拡張（インメモリ）

**目標**  
既存のインメモリストアを拡張し、打ち合わせ名・ルーム名・詳細統計を保存できるようにする

### ステップ 1-1: バックエンド API の拡張（保存データに meetingName と roomName を追加）

- `POST /api/rooms/:roomId/stats` のリクエストボディに `meetingName` と `roomName` を追加
- インメモリストアに `meetingName` と `roomName` を保存
- **確認**: 既存の保存 API が動作することを確認

### ステップ 1-2: フロントエンドから meetingName と roomName を送信

- `MeasurementMode.tsx` の `saveRoomStats` 呼び出し時に `meetingName` と `roomName` を追加
- **確認**: バックエンドで `meetingName` と `roomName` が保存されることを確認

### ステップ 1-3: バックエンド API の拡張（詳細統計の保存）

- `POST /api/rooms/:roomId/stats` のリクエストボディに詳細統計フィールドを追加
- インメモリストアに詳細統計を保存
- **確認**: 詳細統計が保存されることを確認

### ステップ 1-4: フロントエンドで詳細統計を計算して送信

- `MeasurementMode.tsx` で各参加者の詳細統計を計算
- `saveRoomStats` 呼び出し時に詳細統計を含める
- **確認**: 詳細統計が正しく計算・保存されることを確認

### ステップ 1-5: 全体統計の保存 API 追加

- `POST /api/rooms/:roomId/overall-stats` エンドポイントを追加
- インメモリストアに全体統計を保存
- **確認**: 全体統計が保存されることを確認

### ステップ 1-6: フロントエンドから全体統計を送信

- `MeasurementMode.tsx` で全体統計を計算
- `saveRoomOverallStats` 関数を追加して呼び出し
- **確認**: 全体統計が正しく計算・保存されることを確認

## フェーズ 2: 保存間隔の変更

**目標**  
10 秒ごとから 1 秒ごとの保存に変更

### ステップ 2-1: 保存間隔を 1 秒に変更

- `MeasurementMode.tsx` の `setInterval` を `10000ms` から `1000ms` に変更
- **確認**: 1 秒ごとに保存されることを確認（ログで確認）

### ステップ 2-2: パフォーマンス確認と最適化

- 1 秒ごとの保存が問題なく動作することを確認
- 必要に応じてバッチ処理や最適化を検討
- **確認**: パフォーマンスに問題がないことを確認

## フェーズ 3: 閲覧モードの実装（打ち合わせ名検索）

**目標**  
打ち合わせ名で検索できる閲覧モードを実装

### ステップ 3-1: バックエンド API 追加（打ち合わせ名で検索）

- `GET /api/meetings/:meetingName/stats` エンドポイントを追加
- インメモリストアから打ち合わせ名で検索
- **確認**: 打ち合わせ名でデータが取得できることを確認

### ステップ 3-2: フロントエンド API 関数追加

- `api.ts` に `fetchMeetingStats` 関数を追加
- **確認**: API 関数が正しく動作することを確認

### ステップ 3-3: 閲覧モードの UI 実装（打ち合わせ名入力）

- `HostViewMode.tsx` に打ち合わせ名入力フィールドを追加
- 入力された打ち合わせ名で API を呼び出し
- **確認**: 打ち合わせ名で検索できることを確認

### ステップ 3-4: 閲覧モードの表示拡張（詳細統計表示）

- 各ルームのメンバー統計を詳細表示
  - 平均発話時間
  - 発話シェア
  - バランススコア
- 各ルームの全体統計を表示
- **確認**: 詳細統計が正しく表示されることを確認

## フェーズ 4: ホスト制限の削除

**目標**  
閲覧モードを誰でも使用できるようにする

### ステップ 4-1: モード選択画面の修正

- `ModeSelector.tsx` からホスト制限を削除
- 「ホストのみが閲覧モードを使用できます」のメッセージを削除
- **確認**: 誰でも閲覧モードを選択できることを確認

### ステップ 4-2: コンポーネント名の変更（オプション）

- `HostViewMode.tsx` を `ViewMode.tsx` にリネーム
- `App.tsx` の参照を更新
- **確認**: 名前変更後も動作することを確認

## フェーズ 5: データベース移行（オプション）

**目標**  
インメモリストアからデータベースに移行（本番環境用）

### ステップ 5-1: データベース設定

- PostgreSQL / MySQL / SQLite 等のデータベースを選択
- 接続設定とマイグレーションスクリプトを作成
- **確認**: データベースに接続できることを確認

### ステップ 5-2: スキーマ作成

- `participant_stats` テーブルを作成
- `room_overall_stats` テーブルを作成
- **確認**: テーブルが正しく作成されることを確認

### ステップ 5-3: API のデータベース対応

- インメモリストアの代わりにデータベースを使用
- **確認**: データベースに保存・取得できることを確認

## 実装順序のまとめ

### 推奨順序

1. **フェーズ 1（ステップ 1-1〜1-6）**: バックエンドの基本機能拡張
2. **フェーズ 2（ステップ 2-1〜2-2）**: 保存間隔の変更
3. **フェーズ 3（ステップ 3-1〜3-4）**: 閲覧モードの実装
4. **フェーズ 4（ステップ 4-1〜4-2）**: ホスト制限の削除
5. **フェーズ 5（ステップ 5-1〜5-3）**: データベース移行（必要に応じて）

### 各ステップでの確認方法

- **バックエンド**: Postman や `curl` で API を直接テスト
- **フロントエンド**: ブラウザの開発者ツールでネットワークリクエストを確認
- **データ確認**: バックエンドのログやインメモリストアの内容を確認
